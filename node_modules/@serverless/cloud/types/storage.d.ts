// <reference types="node" />
export type StatResponse = {
  lastModified?: Date
  size: number
  metadata?: any
  type: string
  maxAge?: number
}

export type ReadOptions = {
  buffer?: boolean
}

export type WriteOptions = {
  metadata?: { [key: string]: string }
  type?: string
  maxAge?: number
}

export type WriteResponse = {
  filename: string
  path: string
  metadata: any
}

export type ListOptions = {
  recursive?: boolean
  pageSize?: number
  filter?: string
}

export interface StorageEventHandler {
  (event: { path: string; size: number }): void
}

export declare interface Storage {
  read: (path: string, options?: ReadOptions) => Promise<ReadableStream | Buffer | undefined>
  readBuffer: (path: string) => Promise<Buffer | undefined>
  write: (path: string, data: any, options?: WriteOptions) => Promise<WriteResponse>
  exists: (path: string) => Promise<boolean>
  stat: (path: string) => Promise<StatResponse | undefined>
  list: (path?: string | undefined, options?: ListOptions) => AsyncGenerator<string[]>
  move: (absPath: string, destPath: string) => Promise<void>
  on: (specifier: string | string[], handler: StorageEventHandler) => void
  copy: (absPath: string, destPath: string) => Promise<void>
  getUploadUrl: (path: string, expiresIn?: number) => Promise<string>
  getDownloadUrl: (path: string, expiresIn?: number) => Promise<string>
  remove: (absPath: string) => Promise<void>
}

declare const storage: Storage
export default storage
